<!DOCTYPE html>
<html lang="en">
   <head>
       <meta charset="utf-8">
       <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
       <title>TrappingVsContextSwitching 07 Oct 2018</title>
   </head>
    <style>

    a.link {
        border-bottom: 1px dashed #a30000;
        color: #a30000;
        text-decoration: none;
    }
    pre {
       width:650px;
       margin: 0 auto;
       font-size:12px; /* 13px will make it bold */
    }
    .code {
        color:white;
        border-radius:5px;
        background-color:#2d3238;
        padding:5px;
        overflow: auto; /* enables horizontal scroll bars to code blocks */
    }
    .center {
		display: inline-block;
		margin: 0 auto;
		max-width: 620px;
	}
    </style>

    <body>
        <pre>
<b>Trap Frame is stack frame generated by the OS with the help from the processor.</b>
<b>When you are executing your code. For example, if your code invokes a syscall,</b>
<b>this will cause the processor to invoke the predefined trap handler of the OS</b>
<b>and the OS will capture the current registers at the time of syscall as a</b>
<b>TrapFrame and then calls the necessary System call handler function. This</b>
<b>TrapFrame gets also generated not only during syscalls but also during</b>
<b>exception/interrupts(timer) etc. Basically, TrapFrame is meant to temporarily save</b>
<b>the current execution context of the thread and then continue with other work so</b>
<b>that once the work is done the processor can resume back(how?). This makes lot</b>
<b>of sense if we question our self on "how does the OS gets a chance to run and</b>
<b>do its job like scheduling in a uniprocessor system where only a single (user)</b>
<b>program can run at any given point in time?". Whenever, a thread is executing,</b>
<b>let's say some user code, The APIC (timer) generates timer interrupt because of</b>
<b>which the processor which is executing the user code gets interrupted, as part</b>
<b>of it, the processor traps the current execution and gives the OS kernel the</b>
<b>control to respond, during this time the kernel checks for the thread quantum to</b>
<b>decrease. If the quantum for the thread has completely lapsed then, the kernel will</b>
<b>run the scheduling(the act of selecting new thread) and fires up the dispatching</b>
<b>(the act of running new thread. This is called Context Switching). If the</b>
<b>quantum for the thread is not lapsed then the thread continues to execute. Now</b>
<b>it makes sense how the OS kernel gets to run for its chance and the important</b>
<b>point is the kernel does this in the context of the currently running thread.</b>

<b>Mode transition or trap handling and Context Switching are not one and the same</b>
<b>they are completely different. Trap handling happens on the current thread</b>
<b>whereas context switching is selecting a different thread for execution.</b>

<b><a href="DebuggersContext-07-Oct-2018.png" target="_blank"><img class="center" src="DebuggersContext-07-Oct-2018.png"/></a></b>
        </pre>
        <div>
            <script src="https://utteranc.es/client.js"
                repo="vineelkovvuri/vineelkovvuri.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async>
            </script>
        </div>
    </body>
</html>
