<!DOCTYPE html>
<html lang="en">
   <head>
       <meta charset="utf-8">
       <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
       <title>LP64vsLLP64 x64ABI 09 Sep 2018</title>
   </head>
    <style>

    a.link {
        border-bottom: 1px dashed #a30000;
        color: #a30000;
        text-decoration: none;
    }
    pre {
       width:650px;
       margin: 0 auto;
       font-size:12px; /* 13px will make it bold */
    }
    .code {
        color:white;
        border-radius:5px;
        background-color:#2d3238;
        padding:5px;
        overflow: auto; /* enables horizontal scroll bars to code blocks */
    }
    .center {
		display: inline-block;
		margin: 0 auto;
		max-width: 620px;
	}
    </style>

    <body>
        <pre>

<b>In researching about how signed and unsigned integer conversions work in C</b>
<b>language, I came to find that the size of long is 4 on Windows x64 when compiled</b>
<b>with VC++ compiler. Interestingly, the size of long is 8 on Linux x64</b>
<b>(via Godbolt compiler explorer) with clang. Now, there is clearly something else</b>
<b>is contributing to these differences, And my assumption of on every x64 platform</b>
<b>long is 4 bytes is incorrect and not all x64 platforms has same size either.</b>

<b>This is when I tried to dig little deeper to answer "How does the size of long</b>
<b>data type determined by the compilers?". The compilers determine(fix) the size</b>
<b>of the data type according to the specification of Application Binary Interface</b>
<b>(ABI) of the platform(OS). This is also called as "64-bit programming models".</b>
<b>Looks like we have not just one model but three!</b>

<b>There are three basic models that can be chosen, LP64, ILP64 and LLP64 as shown</b>
<b>in the following table. The notation describes the width assigned to the basic</b>
<b>data types. LP64 (also known as 4/8/8) denotes long and pointer as 64 bit types,</b>
<b>ILP64 (also known as 8/8/8) means int, long and pointer are 64 bit types and</b>
<b>LLP64 (also known as 4/4/8) adds a new type (long long) and pointer as 64 bit</b>
<b>types. Most of today's 32 bit systems are ILP32 (that is, int, long and pointers</b>
<b>are all 32-bits wide).</b>

<b>Datatype    LP64    ILP64   LLP64   ILP32   LP32</b>
<b>char        8       8       8       8       8</b>
<b>short       16      16      16      16      16</b>
<b>int         32      64      32      32      16</b>
<b>long        64      64      32      32      32</b>
<b>long long                   64</b>
<b>pointer     64      64      64      32      32</b>

<b>Most Unix systems follow AMD64/System V Application Binary Interface ABI. This</b>
<b>specification talks about two models "Binaries using the AMD64 instruction set</b>
<b>may program to either a 32-bit model, in which the C data types int, long and</b>
<b>all pointer types are 32-bit objects (ILP32); or to a 64-bit model, in which the</b>
<b>C int type is 32-bits but the C long type and all pointer types are 64-bit</b>
<b>objects (LP64)." So looks like the clang compiler I was using in godbolt's</b>
<b>website is based on LP64 ABI hence int is 4, long is 8 and pointer is 8. But on</b>
<b>Windows x64, it uses LLP64 so only long long is 8 and pointer is 8 bytes.</b>
<b>Raymond Chen has a blog post about it.</b>

<b>References:</b>
<b><a class='link' href='http://www.unix.org/version2/whatsnew/lp64_wp.html'>http://www.unix.org/version2/whatsnew/lp64_wp.html</a></b>
<b>System V Application Binary Interface AMD64 Architecture Processor Supplement</b>
    <a class='link' href='https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf'>https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf</a>
<b>Why did the Win64 team choose the LLP64 model?</b>
    <a class='link' href='https://blogs.msdn.microsoft.com/oldnewthing/20050131-00/?p=36563'>https://blogs.msdn.microsoft.com/oldnewthing/20050131-00/?p=36563</a>
<b><a class='link' href='https://docs.microsoft.com/en-us/windows/desktop/winprog64/abstract-data-models'>https://docs.microsoft.com/en-us/windows/desktop/winprog64/abstract-data-models</a></b>

        </pre>
        <div>
            <script src="https://utteranc.es/client.js"
                repo="vineelkovvuri/vineelkovvuri.github.io"
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async>
            </script>
        </div>
    </body>
</html>
