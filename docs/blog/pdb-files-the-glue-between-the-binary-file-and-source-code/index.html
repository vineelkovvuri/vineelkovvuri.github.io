<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pdb Files: The Glue Between The Binary File And Source Code | Vineel Kovvuri</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" rel="stylesheet">

  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/blog/">Blog</a></li>
      
      <li><a href="/presentations/">Presentations</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Pdb Files: The Glue Between The Binary File And Source Code</span></h1>

<h2 class="date">2019/01/10</h2>
</div>

<main>
<h1 id="introduction">Introduction</h1>
<p>Have you ever wondered how a debugger magically gets you to the correct pdb and
correct sources when debugging an application? This article talks exactly that in
the context of Windbg.</p>
<p>As you might be aware of, PDB files(also called as symbol files) is the glue
between your application binary and the source code. There are two key Environment
variables which configures Windbg about where to look for symbols and sources.
They are _NT_SYMBOL_PATH and _NT_SOURCE_PATH. The _NT_SYMBOL_PATH points
to the directory containing your PDBs(also called as symbol files) or to a symbol
server. _NT_SOURCE_PATH points to the directory of your sources or to a source
server which indexes the soruce files. One important point to remember here is
one or more source files make up one or more binary files. But each binary will
have a single PDB unless the source code is modified. This is important because
Windbg has to perform lot of book keeping to map binary symbols with their source
locations.</p>
<p>In this article we would like to understand how Windbg brings the right symbols
and sources from both Symbol Server and Source Server even when the binary changes
across the debugging sessions. Below are the three topics that we are going to
understand.</p>
<ul>
<li>How do Windbg identify the correct symbol file?</li>
<li>How do Windbg identify the correct source file?</li>
<li>Windbg Symbols and Sources search heuristics</li>
</ul>
<h1 id="how-do-windbg-identify-the-correct-symbol-file">How do Windbg identify the correct symbol file?</h1>
<p>Whenever an application is compiled the compiler will generate a pdb file associated
with it. These pdbs comes in two variants one containing public symbols and other
contianing private symbols. Public symbols does not contain all the information
related to the binary and sources. Where as private symbols have every possible
information (like line number/local variables/parameters info) related to the
binary and sources. Every company who tries protect their intellectual property
does not publish their private symbols because they contains way too much information
which facilites reverse engineering the binaries much easier. Ofcourse, I should
mention nothing really stop a skillful reverse engineer. That said, public symbols
only gives the customer basic information about the components shipped by these
companies. Since we are dealing with our own application we can assume we have
access to private symbols which are much more helpful.</p>
<p>When application is being built the compiler embeds a GUID and the absolute path
to the pdb in to binary. Also, it embeds the same GUID in to the generated PDB.
This GUID acts as a hash for windbg to check whether the pdb located by the embedded
path or via _NT_SYMBOL_PATH matches or not. In cases where we are using symbol
server it queries the symbol server for the appropriate pdb based on the guid.</p>
<p>We can get this information either through dumpbin /headers module.exe or using
!lmi module as shown below respectively</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">...
</span></span></span><span style="display:flex;"><span><span style="color:#888"> Debug Directories
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">        Time Type        Size      RVA  Pointer
</span></span></span><span style="display:flex;"><span><span style="color:#888">    -------- ------- -------- -------- --------
</span></span></span><span style="display:flex;"><span><span style="color:#888">    5A6C0899 cv            53 0001A8B4     94B4    Format: RSDS, {BB6248C9-7748-4F74-9CBA-147BF261F206}, 1, C:\Programs\Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">...
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; !lmi Sample
</span></span></span><span style="display:flex;"><span><span style="color:#888">Loaded Module Info: [sample]
</span></span></span><span style="display:flex;"><span><span style="color:#888">         Module: Sample
</span></span></span><span style="display:flex;"><span><span style="color:#888">   Base Address: 00007ff6ff400000
</span></span></span><span style="display:flex;"><span><span style="color:#888">     Image Name: Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">   Machine Type: 34404 (X64)
</span></span></span><span style="display:flex;"><span><span style="color:#888">     Time Stamp: 5a6c0899 Fri Jan 26 21:05:29 2018
</span></span></span><span style="display:flex;"><span><span style="color:#888">           Size: 24000
</span></span></span><span style="display:flex;"><span><span style="color:#888">       CheckSum: 0
</span></span></span><span style="display:flex;"><span><span style="color:#888">Characteristics: 22
</span></span></span><span style="display:flex;"><span><span style="color:#888">Debug Data Dirs: Type  Size     VA  Pointer
</span></span></span><span style="display:flex;"><span><span style="color:#888">             CODEVIEW    53, 1a8b4,    94b4 RSDS - GUID: {BB6248C9-7748-4F74-9CBA-147BF261F206}
</span></span></span><span style="display:flex;"><span><span style="color:#888">               Age: 1, Pdb: C:\Programs\Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">           VC_FEATURE    14, 1a908,    9508 [Data not mapped]
</span></span></span><span style="display:flex;"><span><span style="color:#888">    Symbol Type: DEFERRED - No error - symbol load deferred
</span></span></span><span style="display:flex;"><span><span style="color:#888">    Load Report: no symbols loaded
</span></span></span></code></pre></div><p>If the GUID in pdb does not match with embedded GUID in binary it does not load
the PDB file and throws following error *** ERROR: Module load completed but
symbols could not be loaded for Win32Sample.exe.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">0:000&gt; .sympath E:\temp\Testing\x64\Release\ &lt;-- Incorrect pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">Symbol search path is: E:\temp\Testing\x64\Release\
</span></span></span><span style="display:flex;"><span><span style="color:#888">Expanded Symbol search path is: e:\temp\testing\x64\release\
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">************* Path validation summary **************
</span></span></span><span style="display:flex;"><span><span style="color:#888">Response                         Time (ms)     Location
</span></span></span><span style="display:flex;"><span><span style="color:#888">OK                                             E:\temp\Testing\x64\Release\
</span></span></span><span style="display:flex;"><span><span style="color:#888">*** WARNING: Unable to verify checksum for Win32Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">*** ERROR: Module load completed but symbols could not be loaded for Win32Sample.exe
</span></span></span></code></pre></div><h1 id="how-do-windbg-identify-the-correct-source-file">How do Windbg identify the correct source file?</h1>
<p>PDB files contain not only information about symbols like functions/structures/classes
etc but also about the artifacts(like .obj) involved in generating your application
binary. Unfortunately examining this information from PDB is little complicated
because the PDB format is not documented by Microsoft. But the good news is
Microsoft has provided an API to query the information about any given PDB. This
API is called <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/debug-interface-access/debug-interface-access-sdk">Debug Interface Access SDK</a>.
Luckily, every installation of Visual Studio ships with a sample project aptly
named as Dia2Dump at C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\DIA
SDK\Samples\DIA2Dump. When you build this project in Visual Studio we get
Dia2Dump.exe, Using this we can solve the second puzzle.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">usage: Dia2Dump.exe [ options ] &lt;filename&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -?                : print this help
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -all              : print all the debug info
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -m                : print all the mods
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -p                : print all the publics
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -g                : print all the globals
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -t                : print all the types
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -f                : print all the files
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -s                : print symbols
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -l [RVA [bytes]]  : print line number info at RVA address in the bytes range
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -c                : print section contribution info
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -dbg              : dump debug streams
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -injsrc [file]    : dump injected source
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -sf               : dump all source files
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -oem              : dump all OEM specific types
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -fpo [RVA]        : dump frame pointer omission information for a func addr
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -fpo [symbolname] : dump frame pointer omission information for a func symbol
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -compiland [name] : dump symbols for this compiland
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -lines &lt;funcname&gt; : dump line numbers for this function
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -lines &lt;RVA&gt;      : dump line numbers for this address
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -type &lt;symbolname&gt;: dump this type in detail
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -label &lt;RVA&gt;      : dump label at RVA
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -sym &lt;symbolname&gt; [childname] : dump child information of this symbol
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -sym &lt;RVA&gt; [childname]        : dump child information of symbol at this addr
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -lsrc  &lt;file&gt; [line]          : dump line numbers for this source file
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -ps &lt;RVA&gt; [-n &lt;number&gt;]       : dump symbols after this address, default 16
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -psr &lt;RVA&gt; [-n &lt;number&gt;]      : dump symbols before this address, default 16
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -annotations &lt;RVA&gt;: dump annotation symbol for this RVA
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -maptosrc &lt;RVA&gt;   : dump src RVA for this image RVA
</span></span></span><span style="display:flex;"><span><span style="color:#888">  -mapfromsrc &lt;RVA&gt; : dump image RVA for src RVA
</span></span></span></code></pre></div><p>The most important of all these flags is -sf which will dump out all the source
files used to create an obj(object file). A sample output form this command
Dia2Dump.exe -sf <path of pdb file> with a PDB will be as shown below</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">....
</span></span></span><span style="display:flex;"><span><span style="color:#888">Compiland = C:\..&lt;snipped&gt;..\Win32Sample\x64\Release\Win32Sample.obj
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\shared\basetsd.h (MD5: 464E631AE358F42C09701CE07F35F8BF)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\shared\guiddef.h (MD5: CA7D066706A198EA5999B084AAB0CE58)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\shared\stralign.h (MD5: D27BD3C9FFF58FF4798B1F17B38C5B06)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\shared\winerror.h (MD5: 7AD19053F0A83DDC031CDE4638299080)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\ucrt\corecrt_memory.h (MD5: 33686D742EF373658431918E1A52326C)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\ucrt\ctype.h (MD5: 1AC17C8CFC2358BD87784AB186BBAFCC)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\ucrt\stdlib.h (MD5: 49CF59C87D23BB42C2D25CDF0D089509)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\ucrt\string.h (MD5: 1DD6630B6C5E4B83DE098670242950A2)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\memoryapi.h (MD5: 6F6D38BE202064596573E9449CBAAC58)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\oleauto.h (MD5: 9048E2C1FD07AD42EA6E7F51EF63D42B)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\processthreadsapi.h (MD5: 65891E84D54E51FA2017AB4D17BF9958)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\propidl.h (MD5: B19A6DCE51821A635FE051DBC1CE6E7E)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\winbase.h (MD5: 86C4964B16E8566D1E8F05482D9FFA49)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\winnt.h (MD5: 02092055CFA70103E984B6855200845C)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\10.0.15063.0\um\winuser.h (MD5: 8A3479DAEAB702729FFBA6C669F54438)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\win32sample\stdafx.h (MD5: AA9C091299F07AD95BB49E6EE4BFF136)
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\win32sample\win32sample.cpp (MD5: BBB7EE64784A7C2A96B1439310EEF84A)  &lt;---
</span></span></span><span style="display:flex;"><span><span style="color:#888">        c:\..&lt;snipped&gt;..\win32sample\x64\release\win32sample.pch
</span></span></span><span style="display:flex;"><span><span style="color:#888">....
</span></span></span></code></pre></div><p>The above information clearly suggests that PDB also contains hash of all the
files needed to create a obj. This hash could be MD5 or SHA256(which is often
denoted with 0x3), This can be verified using simple get-filehash commandlet on
our source file(Win32Sample.cpp) as shown below. Similar to GUID which binds a
binary with PDB file this file checksum will bind the binary with its appropriate
source file. But the checking of source files against its checksum is somewhat
relax(more on this later).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">PS&gt; get-filehash -Algorithm MD5 &#34;c:\&lt;snipped&gt;\win32sample\win32sample.cpp&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">Algorithm Hash                              Path
</span></span></span><span style="display:flex;"><span><span style="color:#888">--------- ----                              ----
</span></span></span><span style="display:flex;"><span><span style="color:#888">MD5       BBB7EE64784A7C2A96B1439310EEF84A  C:\&lt;snipped&gt;\win32sample\win32sample.cpp
</span></span></span></code></pre></div><p>This confirms the PDB is indeed storing the MD5 Hash of the file content.</p>
<p>Because each PDB contains symbol and line number information it can open the
appropriate source file and at the correct line number.</p>
<p>Whenever windbg tries to open a source file associated with a symbol it tries to
check for this checksum of the source file.</p>
<h1 id="windbg-symbols-and-sources-search-heuristics">Windbg Symbols and Sources search heuristics</h1>
<p>If the absolute paths embeded in the PDB file is all we have then debugging in
Windbg would not be any interesting and fun. Practically we cannot have the pdbs
and sources available at the embedded paths(for example a program being debugged
at the client machine). So how does Windbg figures out the right PDB even when
the symbol paths set via .sympath+ or _NT_SYMBOL_PATH and the source path set
via .srcpath+ or _NT_SOURCE_PATH are different from the actual embeded paths
in the PDB?</p>
<p>To understand this we need to enable !sym noisy and .srcnoisy 3 when debugging.
As an example I have my original source code built from C:\users\vineelko\documents\visual
studio 2017\projects\win32sample which generated below files</p>
<ul>
<li>Sources: C:&lt;snipped&gt;\Win32Sample\Win32Sample.c</li>
<li>Binary:  C:&lt;snipped&gt;\Win32Sample\x64\Release\Win32Sample.exe</li>
<li>PDB:     C:&lt;snipped&gt;\Win32Sample\x64\Release\Win32Sample.pdb</li>
</ul>
<p>Lets say we moved the folder from C:\Users\vineelko\Documents\Visual Studio
2017\Projects\ to E:\Temp\  like below</p>
<ul>
<li>Sources: E:\Temp\Win32Sample\Win32Sample.c</li>
<li>Binary:  E:\Temp\Win32Sample\x64\Release\Win32Sample.exe</li>
<li>PDB:     E:\Temp\Win32Sample\x64\Release\Win32Sample.pdb</li>
</ul>
<p>Now when we start debugging session windbg.exe E:\Temp\Win32Sample\x64\Release\Win32Sample.exe
Windbg tries to find the .c and .pdb from C:\Users\vineelko\Documents\Visual Studio
2017\Projects\Win32Sample but will not find them as they are moved. This is where
we have to make use of .sympath+ E:\Temp\Win32Sample\x64\Release and .srcpath+
E:\Temp\Win32Sample. Also running !sym noisy and .srcnoisy 3 commands will enable
tracing of debugger when it is searching for the symbol files and source files
respectively.</p>
<p>Below is the output of !lmi which dumps the GUID and the PDB location.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">0:000&gt; !lmi Win32Sample
</span></span></span><span style="display:flex;"><span><span style="color:#888">Loaded Module Info: [win32sample]
</span></span></span><span style="display:flex;"><span><span style="color:#888">         Module: Win32Sample
</span></span></span><span style="display:flex;"><span><span style="color:#888">   Base Address: 00007ff62d2f0000
</span></span></span><span style="display:flex;"><span><span style="color:#888">     Image Name: Win32Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">   Machine Type: 34404 (X64)
</span></span></span><span style="display:flex;"><span><span style="color:#888">     Time Stamp: 5a6c354c Sat Jan 27 00:16:12 2018
</span></span></span><span style="display:flex;"><span><span style="color:#888">           Size: 7000
</span></span></span><span style="display:flex;"><span><span style="color:#888">       CheckSum: 0
</span></span></span><span style="display:flex;"><span><span style="color:#888">Characteristics: 22
</span></span></span><span style="display:flex;"><span><span style="color:#888">Debug Data Dirs: Type  Size     VA  Pointer
</span></span></span><span style="display:flex;"><span><span style="color:#888">             CODEVIEW    78,  2368,    1568 RSDS - GUID: {7FAA9AFE-D714-4E38-B2CE-A99C41BF8CD4}
</span></span></span><span style="display:flex;"><span><span style="color:#888">               Age: 1, Pdb: C:\Users\vineelko\Documents\Visual Studio 2017\Projects\Win32Sample\x64\Release\Win32Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">           VC_FEATURE    14,  23e0,    15e0 [Data not mapped]
</span></span></span><span style="display:flex;"><span><span style="color:#888">                 POGO   26c,  23f4,    15f4 [Data not mapped]
</span></span></span><span style="display:flex;"><span><span style="color:#888">    Symbol Type: DEFERRED - No error - symbol load deferred
</span></span></span><span style="display:flex;"><span><span style="color:#888">    Load Report: no symbols loaded
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">Turn on verbose symbol logging
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; !sym noisy
</span></span></span><span style="display:flex;"><span><span style="color:#888">noisy mode - symbol prompts on
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">Try setting the symbol path to E:\temp\Testing
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; .sympath E:\temp\Testing\
</span></span></span><span style="display:flex;"><span><span style="color:#888">Symbol search path is: E:\temp\Testing\
</span></span></span><span style="display:flex;"><span><span style="color:#888">Expanded Symbol search path is: e:\temp\testing\
</span></span></span><span style="display:flex;"><span><span style="color:#888">************* Path validation summary **************
</span></span></span><span style="display:flex;"><span><span style="color:#888">Response                         Time (ms)     Location
</span></span></span><span style="display:flex;"><span><span style="color:#888">OK                                             E:\temp\Testing\
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">Try reloading the binary PDB
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; .reload /f win32sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: e:\temp\testing\Win32Sample.pdb - file not found
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: e:\temp\testing\exe\Win32Sample.pdb - file not found
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: e:\temp\testing\symbols\exe\Win32Sample.pdb - file not found
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: C:\Users\vineelko\Documents\Visual Studio 2017\Projects\Win32Sample\x64\Release\Win32Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">- file not found
</span></span></span><span style="display:flex;"><span><span style="color:#888">*** WARNING: Unable to verify checksum for Win32Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">*** ERROR: Module load completed but symbols could not be loaded for Win32Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: Win32Sample - no symbols loaded
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; .sympath E:\temp\Testing\x64\Release
</span></span></span><span style="display:flex;"><span><span style="color:#888">0:000&gt; .reload /f win32sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">*** WARNING: Unable to verify checksum for Win32Sample.exe
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGHELP: Win32Sample - private symbols &amp; lines
</span></span></span><span style="display:flex;"><span><span style="color:#888">        e:\temp\testing\x64\release\Win32Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">0:000&gt; lm
</span></span></span><span style="display:flex;"><span><span style="color:#888">start             end                 module name
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff6`2d2f0000 00007ff6`2d2f7000   Win32Sample C (private pdb symbols)
</span></span></span><span style="display:flex;"><span><span style="color:#888">e:\temp\testing\x64\release\Win32Sample.pdb
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff9`0c5e0000 00007ff9`0c5f6000   VCRUNTIME140   (deferred)
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff9`2c110000 00007ff9`2c206000   ucrtbase   (deferred)
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff9`2c430000 00007ff9`2c696000   KERNELBASE   (deferred)
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff9`2f160000 00007ff9`2f20e000   KERNEL32   (deferred)
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff9`2f400000 00007ff9`2f5e0000   ntdll      (export symbols)
</span></span></span><span style="display:flex;"><span><span style="color:#888">C:\WINDOWS\SYSTEM32\ntdll.dll
</span></span></span></code></pre></div><p>Looking at the .reload command output we can say Windbg expects symbol files to
be present inside the same directory as the application or the folder named &rsquo;exe&rsquo;
inside .sympath directory or the folder named &lsquo;dll&rsquo; inside the .sympath directory
or at the actual embedded path. Running lm confirms that symbols are recognized
for Win32Sample.exe</p>
<p>Turn on verbose source logging</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">0:000&gt; !srcnoisy 3
</span></span></span><span style="display:flex;"><span><span style="color:#888">Noisy source output: on
</span></span></span><span style="display:flex;"><span><span style="color:#888">Noisy source server output: on
</span></span></span><span style="display:flex;"><span><span style="color:#888">Filter out everything but source server output: off
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; .srcpath e:\temp\Testing
</span></span></span><span style="display:flex;"><span><span style="color:#888">Source search path is: e:\temp\Testing
</span></span></span><span style="display:flex;"><span><span style="color:#888">************* Path validation summary **************
</span></span></span><span style="display:flex;"><span><span style="color:#888">Response                         Time (ms)     Location
</span></span></span><span style="display:flex;"><span><span style="color:#888">OK                                             e:\temp\Testing
</span></span></span><span style="display:flex;"><span><span style="color:#888"></span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#888">0:000&gt; x win32Sample!main
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff6`2d2f1060 Win32Sample!main (void)
</span></span></span><span style="display:flex;"><span><span style="color:#888">0:000&gt; bu win32Sample!main
</span></span></span><span style="display:flex;"><span><span style="color:#888">0:000&gt; g
</span></span></span><span style="display:flex;"><span><span style="color:#888">Breakpoint 0 hit
</span></span></span><span style="display:flex;"><span><span style="color:#888">Win32Sample!main:
</span></span></span><span style="display:flex;"><span><span style="color:#888">00007ff6`2d2f1060 4883ec48        sub     rsp,48h
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users\vineelko\documents\visual studio 2017\projects\win32sample&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users\vineelko\documents\visual studio 2017\projects\win32sample&#39;: 66 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users\vineelko\documents\visual studio 2017\projects&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users\vineelko\documents\visual studio 2017\projects&#39;: 54 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users\vineelko\documents\visual studio 2017&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users\vineelko\documents\visual studio 2017&#39;: 45 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users\vineelko\documents&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users\vineelko\documents&#39;: 26 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users\vineelko&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users\vineelko&#39;: 16 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:\users&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:\users&#39;: 7 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan paths for partial path match:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    prefix &#39;c:&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    suffix &#39;users\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      match &#39;e:\temp\Testing&#39; against &#39;c:&#39;: 1 (match &#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;c:\users\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\c:\users\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;users\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\users\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\vineelko\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\documents\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\visual studio 2017\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\projects\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\win32sample\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:  Scan all paths for:
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:    &#39;win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      check &#39;e:\temp\Testing\win32sample.cpp&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#888">DBGENG:      found file &#39;e:\temp\Testing\win32sample.cpp&#39;
</span></span></span></code></pre></div><p>Source path heuristics to match a source file is much more involved, It is done
by prefix and suffix matches by joining the file path and .srcpath directory. If
the checksum of the file present in PDB does does not match with the file checksum
then you should see a warning like below(Which is very important). Unlike symbol
files, Eventhough Windbg throws a warning it opens the source file in code window.
But we should be vigilient about it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#888">windbg&gt; .open -a Win32Sample!main
</span></span></span><span style="display:flex;"><span><span style="color:#888">WARNING: Unable to find source file with matching checksum.  Found
</span></span></span><span style="display:flex;"><span><span style="color:#888">&#39;c:\&lt;snipped&gt;\win32sample\win32sample.cpp&#39; with mismatch!
</span></span></span></code></pre></div><p>In any case, Understanding these details will help us solve unresolved source and
symbol files issue with much more confidence!</p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://www.wintellect.com/pdb-files-what-every-developer-must-know/">PDB Files: What Every Developer Must Know</a></li>
<li><a href="https://docs.microsoft.com/en-us/visualstudio/debugger/debug-interface-access/debug-interface-access-sdk">Debug Interface Access SDK</a></li>
</ul>

</main>

  <footer>
  
<script defer src="/js/center-img.js"></script>







  
  <hr/>
  © <a href="https://vineelkovvuri.github.io">Vineel Kumar Reddy Kovvuri</a> 2017 &ndash; 2025 ❤️ <a href="https://xmin.yihui.org/">Hugo Xmin</a>
  
  </footer>
  </body>
</html>

